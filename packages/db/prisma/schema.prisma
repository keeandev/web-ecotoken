// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

model Permission {
    permissionID String     @id @default(cuid())
    domain       UserDomain
    permission   String     @unique
    description  String?    @db.Text

    roles Role[]

    isDelete  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("permission")
}

enum UserDomain {
    ADMIN
    USER
}

model Role {
    roleID      String     @id @default(cuid())
    domain      UserDomain
    scope       RoleScope  @default(DEFAULT)
    role        String
    description String?    @db.Text

    permissions Permission[]
    sites       Site[]
    adminUsers  AdminUser[]
    users       User[]

    isDelete  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("role")
}

enum RoleScope {
    DEFAULT
    SITE
}

// model User {
//     id            String  @id @default(cuid())
//     walletAddress String  @unique
//     emailAddress  String? @unique
//     name          String?
//     profileUrl    String?
//     verifier      String?
//     typeOfLogin   String?

//     createdAt DateTime @default(now())
//     updatedAt DateTime @updatedAt

//     site   Site   @relation(fields: [siteID], references: [siteID])
//     siteID String

//     @@index([siteID])
//     @@map("user")
// }

model User {
    userID        String  @id @default(cuid())
    companyName   String? @unique
    firstName     String
    lastName      String?
    username      String
    password      String
    emailAddress  String  @unique
    walletAddress String? @unique

    site      Site        @relation(fields: [siteID], references: [siteID])
    siteID    String
    role      Role        @relation(fields: [roleID], references: [roleID])
    roleID    String
    nftSeries NFTSeries[]

    isDelete  Boolean  @default(false)
    isDisable Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([username, siteID])
    @@index([siteID])
    @@index([roleID])
    @@map("user")
}

model AdminUser {
    adminID   String    @id @default(cuid())
    username  String    @unique
    password  String
    email     String
    firstName String
    lastName  String?
    lastLogin DateTime?
    expireAt  DateTime?
    hits      Int       @default(0)

    role   Role   @relation(fields: [roleID], references: [roleID])
    roleID String

    isActive  Boolean  @default(true)
    isDelete  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([roleID])
    @@map("admin_user")
}

model Site {
    siteID      String  @id @default(cuid())
    siteName    String
    legalName   String?
    mailAddress String?
    prodUrl     String? @unique
    stageUrl    String? @unique
    devUrl      String? @unique

    users     User[]
    roles     Role[]
    locations EcoLocation[]
    projects  EcoProject[]

    isDelete  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("site")
}

model EcoLocation {
    locationID String @id @default(cuid())
    areaID     Int    @default(autoincrement()) @db.UnsignedSmallInt
    location   String
    cn         String
    st         String

    site     Site         @relation(fields: [siteID], references: [siteID])
    siteID   String
    projects EcoProject[]

    isDelete  Boolean  @default(false)
    updatedAt DateTime @updatedAt

    @@index([areaID])
    @@index([siteID])
    @@map("eco_location")
}

model EcoBenefit {
    benefitID String  @id @default(cuid())
    ord       Int     @default(0)
    bftTitle  String
    benefit   String
    photo     String?

    projects EcoProject[]

    isVisible Boolean  @default(true)
    isDelete  Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("eco_benefit")
}

model EcoProject {
    projectID  String        @id @default(cuid())
    ord        Int           @default(0)
    prdUserID  Int?
    vfyUserID  Int?
    ecoNftID   Int           @db.UnsignedInt
    ecoType    ProjectType
    ecoTitle   String
    shortTitle String
    ecoUrl     String
    intro      String        @db.Text
    project    String        @db.Text
    overview   String        @db.Text
    status     ProjectStatus

    site       Site         @relation(fields: [siteID], references: [siteID])
    siteID     String
    location   EcoLocation  @relation(fields: [locationID], references: [locationID])
    locationID String
    benefits   EcoBenefit[]
    nftSeries  NFTSeries[]

    images       String    @db.Text
    fundAmount   Int?
    fundRecieved Int?
    return       Decimal?  @db.Decimal(5, 2)
    payback      String?
    dateStart    DateTime?
    dateEnd      DateTime?
    isVisible    Boolean   @default(true)
    isDelete     Boolean   @default(false)
    createdAt    DateTime  @default(now())
    updatedAt    DateTime  @updatedAt

    @@index([siteID])
    @@index([locationID])
    @@map("eco_project")
}

enum ProjectStatus {
    PENDING
    COMPLETE
    FUNDED
    OPEN
}

enum ProjectType {
    FUNDED_PROJECT
    CARBON_CREDIT
    WATER_CREDIT
}

model NFTSeries {
    nftSeriesID String @id @default(cuid())

    project    EcoProject @relation(fields: [projectID], references: [projectID])
    projectID  String
    producer   User       @relation(fields: [producerID], references: [userID])
    producerID String

    seriesName     String
    seriesNumber   Int      @db.UnsignedSmallInt
    seriesImage    String
    seriesType     NFTType
    recieveWallet  String
    creditWallet   String
    creditKey      String
    creditAmount   Decimal? @db.Decimal(12, 2)
    producerWallet String

    isActive  Boolean  @default(true)
    createdAt DateTime @default(now())

    @@index([projectID])
    @@index([producerID])
    @@index([seriesNumber])
}

enum NFTType {
    CARBON_CREDIT
    WATER_CREDIT
    BIODIVERSITY
    STEWARDSHIP
}
